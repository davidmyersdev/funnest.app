var e=Object.assign;import{r as t,o as s,c as o,a as n,w as i,b as r,f as a,t as l,d as c,e as d,v as h,F as u,g as p,h as m,i as g,j as f,k as b,l as w,n as v,m as y}from"./vendor.a7dd15db.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,i)=>{const r=new URL(e,o);if(self[t].moduleMap[r])return s(self[t].moduleMap[r]);const a=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){i(new Error(`Failed to import: ${e}`)),n(l)},onload(){s(self[t].moduleMap[r]),n(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/assets/");const x={},M={class:"text-gray-700"},S={class:"bg-gray-100"},k={class:"container mx-auto flex justify-between font-bold p-4"},L=r("The Funnest App"),C=r("Doodle");x.render=function(e,r){const a=t("router-link"),l=t("router-view");return s(),o("div",M,[n("nav",S,[n("div",k,[n(a,{to:"/",class:"outline-none border-b-2 border-transparent focus:border-blue-300"},{default:i((()=>[L])),_:1}),n(a,{to:"/doodle",class:"outline-none border-b-2 border-transparent focus:border-blue-300"},{default:i((()=>[C])),_:1})])]),n(l)])};a.initializeApp({apiKey:"AIzaSyCnOVrq3mdje9MP8jQgif-x6AsYc0XNrJw",appId:"1:136870277088:web:83cd70a1198281acaf0585",authDomain:"funnest-app.firebaseapp.com",databaseURL:"https://funnest-app-default-rtdb.firebaseio.com/",measurementId:"G-0BJVSY3LH2",messagingSenderId:"136870277088",projectId:"funnest-app",storageBucket:"funnest-app.appspot.com"}),"localhost"===location.hostname&&(a.auth().useEmulator({}.VITE_APP_FIREBASE_EMULATOR_AUTH),a.database().useEmulator({}.VITE_APP_FIREBASE_EMULATOR_DATABASE_HOST,{}.VITE_APP_FIREBASE_EMULATOR_DATABASE_PORT),a.firestore().useEmulator({}.VITE_APP_FIREBASE_EMULATOR_FIRESTORE_HOST,{}.VITE_APP_FIREBASE_EMULATOR_FIRESTORE_PORT));const z={name:"Doodle",data:()=>({creating:!1,errorMessage:null}),methods:{async createRoom(){this.creating=!0;try{const e=await this.$store.dispatch("createRoom");this.$router.push({name:"doodle_room",params:{roomId:e.id}})}catch(e){this.errorMessage="An unknown error occurred.",this.creating=!1}}}},I={class:"container mx-auto p-4"},R={class:"flex flex-col items-center"},E={key:0,class:"flex items-center p-4 bg-yellow-100 w-full mb-4"},A=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-exclamation-triangle-fill",viewBox:"0 0 16 16"},[n("path",{d:"M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"})],-1),$={class:"ml-4"};z.render=function(e,t,i,r,a,d){return s(),o("div",I,[n("fieldset",R,[a.errorMessage?(s(),o("div",E,[A,n("span",$,l(a.errorMessage),1)])):c("",!0),n("button",{onClick:t[1]||(t[1]=(...e)=>d.createRoom&&d.createRoom(...e)),disabled:a.creating,type:"submit",class:"rounded block w-1/2 bg-gray-100 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300"},l(a.creating?"Creating...":"Create Room"),9,["disabled"])])])};const P={},_={class:"container mx-auto"};P.render=function(e,t){return s(),o("div",_)};const T={name:"Invite",props:{inviteId:String},async mounted(){const e=this.$store.state.rooms.find((e=>e.inviteId===this.inviteId))||await this.$store.dispatch("joinRoom",this.inviteId);this.$router.push({name:"doodle_room",params:{roomId:e.id}})}},U={class:"container mx-auto p-4"},O=n("p",null,"Looking for Room...",-1);T.render=function(e,t,n,i,r,a){return s(),o("div",U,[O])};class H{constructor(e){this.context=e.getContext("2d"),this.context.translate(.5,.5)}clear(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)}drawLine({points:e,options:t}){let[s,...o]=e;this.context.beginPath(),o.forEach((e=>{this.drawLinePath(s,e,t),s=e})),this.context.stroke()}drawLinePath(e,t,s){this.context.lineCap="round",this.context.fillStyle=s.color,this.context.globalCompositeOperation=s.operation,this.context.lineWidth=s.size,this.context.strokeStyle=s.color,this.context.moveTo(e.x,e.y),this.context.lineTo(t.x,t.y)}drawLines(e){e.forEach(this.drawLine,this)}fit(){this.context.canvas.width=this.context.canvas.parentElement.clientWidth,this.context.canvas.height=this.context.canvas.parentElement.clientHeight}}const V={name:"Canvas",props:{readonly:Boolean},data:()=>({canvas:null,color:"#000000",lines:[],size:5,minSize:5,maxSize:20,width:500,height:400,operation:"source-over",showTools:!0,showSizeSlider:!1,unsubscribe:null}),computed:{lastLine(){return this.lines.slice().reverse().find((e=>"self"===e.source))},lastPeerLine(){return this.lines.slice().reverse().find((e=>"peer"===e.source))},lastPoint(){return this.lastLine.points[this.lastLine.points.length-1]},lastPeerPoint(){return this.lastPeerLine.points[this.lastPeerLine.points.length-1]},erasing(){return"destination-out"===this.operation}},methods:{getCoords(e){const t=this.$refs.canvas.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},reset(){this.lines=[],this.canvas.clear(),this.$store.state.peers.forEach((e=>{e.send({type:"reset"})}))},repaint(){this.canvas.clear(),this.canvas.drawLines(this.lines)},undo(){this.lines=this.lines.filter((e=>e!==this.lastLine)),this.repaint(),this.$store.state.peers.forEach((e=>{e.send({type:"undo"})}))},addLine(e){this.lines.push({source:"self",points:[e],options:{color:this.color,operation:this.operation,size:this.size}}),this.$store.state.peers.forEach((t=>{t.send({type:"start",point:e,options:{color:this.color,operation:this.operation,size:this.size}})}))},addSeg(e){const[t,...s]=this.lastLine.points.slice().reverse();this.lastLine.points.push(e),this.canvas.drawLine({points:[t,e],options:{size:this.size,color:this.color,operation:this.operation}}),this.$store.state.peers.forEach((t=>{t.send({type:"move",point:e})}))},peerStart(e,t){this.lines.push({source:"peer",points:[e],options:{color:t.color,operation:t.operation,size:t.size}})},peerMove(e){const t=this.lastPeerPoint;this.lastPeerLine.points.push(e),this.canvas.drawLine({points:[t,e],options:this.lastPeerLine.options})},peerUndo(){this.lines=this.lines.filter((e=>e!==this.lastPeerLine)),this.repaint()},peerReset(){this.lines=[],this.canvas.clear()},toggleEraser(e){this.operation=this.erasing?"source-over":"destination-out"},toggleSizeSlider(){this.showSizeSlider=!this.showSizeSlider},toggleTools(){this.showTools=!this.showTools}},created(){this.unsubscribe=this.$store.subscribe((({type:e,payload:t},s)=>{if("addMessage"===e)switch(t.type){case"start":this.peerStart(t.point,t.options);break;case"move":this.peerMove(t.point);break;case"undo":this.peerUndo();break;case"reset":this.peerReset()}}))},beforeUnmount(){this.unsubscribe&&this.unsubscribe()},mounted(){this.$nextTick((()=>{this.canvas=new H(this.$refs.canvas),this.canvas.fit(),window.addEventListener("resize",(()=>{this.canvas.fit(),this.repaint()}));const e=e=>{const t=this.getCoords(e);this.addSeg(t)},t=s=>{const o=this.getCoords(s);this.addSeg(o),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)},s=e=>{if(1===e.touches.length){const t=this.getCoords(e.touches[0]);this.addSeg(t)}},o=e=>{if(1===e.touches.length){const t=this.getCoords(e.touches[0]);this.addSeg(t)}window.removeEventListener("touchmove",s),window.removeEventListener("touchend",o)};this.$refs.canvas.addEventListener("mousedown",(s=>{if(this.readonly)return;const o=this.getCoords(s);this.addLine(o),window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)})),this.$refs.canvas.addEventListener("touchstart",(e=>{if(e.preventDefault(),!this.readonly&&1===e.touches.length){const t=this.getCoords(e.touches[0]);this.addLine(t),window.addEventListener("touchmove",s),window.addEventListener("touchend",o)}}))}))}},B={class:"relative rounded border-2 border-gray-100"},j={key:1,class:"absolute top-0 right-0 m-2 flex flex-col"},D=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-sliders",viewBox:"0 0 16 16"},[n("path",{"fill-rule":"evenodd",d:"M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"})],-1),F={key:0,class:"flex flex-col align-items-end"},W=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-eraser",viewBox:"0 0 16 16"},[n("path",{d:"M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414l-3.879-3.879zM8.746 13.547L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"})],-1),G=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-arrow-counterclockwise",viewBox:"0 0 16 16"},[n("path",{"fill-rule":"evenodd",d:"M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"}),n("path",{d:"M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"})],-1),N={class:"flex mt-1 relative"},J=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-toggle2-on",viewBox:"0 0 16 16"},[n("path",{d:"M7 5H3a3 3 0 0 0 0 6h4a4.995 4.995 0 0 1-.584-1H3a2 2 0 1 1 0-4h3.416c.156-.357.352-.692.584-1z"}),n("path",{d:"M16 8A5 5 0 1 1 6 8a5 5 0 0 1 10 0z"})],-1),Y={key:0,class:"border rounded flex items-center p-2 mr-2 absolute right-full bg-white top-0 bottom-0 focus-within:ring"},K=n("circle",{cx:"8",cy:"8",r:"8"},null,-1),X=n("circle",{cx:"8",cy:"8",r:"8"},null,-1),q={class:"border rounded bg-white p-3 focus-within:outline-none focus-within:ring relative mt-1"},Q=n("path",{d:"M0 .5A.5.5 0 0 1 .5 0h5a.5.5 0 0 1 .5.5v5.277l4.147-4.131a.5.5 0 0 1 .707 0l3.535 3.536a.5.5 0 0 1 0 .708L10.261 10H15.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H3a2.99 2.99 0 0 1-2.121-.879A2.99 2.99 0 0 1 0 13.044m6-.21l7.328-7.3-2.829-2.828L6 7.188v5.647zM4.5 13a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0zM15 15v-4H9.258l-4.015 4H15zM0 .5v12.495z"},null,-1),Z=n("path",{d:"M0 12.995V13a3.07 3.07 0 0 0 0-.005z"},null,-1),ee=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-trash",viewBox:"0 0 16 16"},[n("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"}),n("path",{"fill-rule":"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"})],-1);V.render=function(e,t,i,r,a,l){return s(),o("div",B,[a.showSizeSlider?(s(),o("div",{key:0,onClick:t[1]||(t[1]=(...e)=>l.toggleSizeSlider&&l.toggleSizeSlider(...e)),class:"absolute top-0 bottom-0 left-0 right-0"})):c("",!0),i.readonly?c("",!0):(s(),o("div",j,[n("button",{onClick:t[2]||(t[2]=(...e)=>l.toggleTools&&l.toggleTools(...e)),class:"border rounded bg-white p-3 focus:outline-none focus:ring"},[D]),a.showTools?(s(),o("div",F,[n("button",{onClick:t[3]||(t[3]=(...e)=>l.toggleEraser&&l.toggleEraser(...e)),class:[{"active bg-red-500 border-red-500 text-white":l.erasing,"bg-white text-red-500 border-red-300":!l.erasing},"border rounded bg-white p-3 focus:outline-none focus:ring mt-1"]},[W],2),n("button",{onClick:t[4]||(t[4]=(...e)=>l.undo&&l.undo(...e)),class:"border rounded bg-white p-3 focus:outline-none focus:ring mt-1"},[G]),n("div",N,[n("button",{onClick:t[5]||(t[5]=(...e)=>l.toggleSizeSlider&&l.toggleSizeSlider(...e)),class:"border rounded bg-white p-3 focus:outline-none focus:ring"},[J]),a.showSizeSlider?(s(),o("div",Y,[(s(),o("svg",{style:{color:a.color},xmlns:"http://www.w3.org/2000/svg",width:a.minSize,height:a.minSize,fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16"},[K],12,["width","height"])),d(n("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>a.size=e),type:"range",min:"5",max:"20",class:"mx-2 rounded focus:outline-none"},null,512),[[h,a.size]]),(s(),o("svg",{style:{color:a.color},xmlns:"http://www.w3.org/2000/svg",width:a.maxSize,height:a.maxSize,fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16"},[X],12,["width","height"]))])):c("",!0)]),n("label",q,[d(n("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>a.color=e),type:"color",class:"absolute h-full w-full top-0 bottom-0 left-0 right-0 focus:outline-none opacity-0"},null,512),[[h,a.color]]),(s(),o("svg",{style:{color:a.color},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",class:"bi bi-palette2",viewBox:"0 0 16 16"},[Q,Z],4))]),n("button",{onClick:t[8]||(t[8]=(...e)=>l.reset&&l.reset(...e)),class:"border rounded bg-white text-red-500 border-red-300 p-3 focus:outline-none focus:ring mt-1"},[ee])])):c("",!0)])),n("canvas",{ref:"canvas",width:a.width,height:a.height,class:"block"},null,8,["width","height"])])};const te={data:()=>({messageRefs:[],text:""}),computed:{messages(){return this.$store.state.messages.filter((e=>"chat"===e.type))}},methods:{scroll(){const e=this.$refs.messagesContainer,t=this.messageRefs[this.messageRefs.length-1];e.scrollTop;const s=e.offsetHeight,o=t.offsetTop-s+t.offsetHeight;e.scroll(0,o)},sendMessage(){this.$store.dispatch("sendMessage",{type:"chat",data:this.text}),this.text=""},setMessageRef(e){this.messageRefs.push(e)}},beforeUpdate(){this.messageRefs=[]},updated(){this.messages.length>0&&this.scroll()}},se={ref:"messagesContainer",class:"rounded border-2 border-gray-100 p-2 h-40 overflow-auto"},oe={class:"text-sm text-gray-400"},ne={class:"truncate"},ie={class:"flex mt-2"};te.render=function(e,t,i,r,a,c){return s(),o("div",null,[n("div",se,[(s(!0),o(u,null,p(c.messages,(e=>(s(),o("div",{ref:c.setMessageRef,class:"bg-gray-100 p-2 mb-2 last:mb-0"},[n("div",oe,l(e.peer.name||e.peer.id),1),n("div",ne,l(e.data),1)],512)))),256))],512),n("fieldset",ie,[d(n("input",{onKeyup:t[1]||(t[1]=m(((...e)=>c.sendMessage&&c.sendMessage(...e)),["enter"])),ref:"invite","onUpdate:modelValue":t[2]||(t[2]=e=>a.text=e),type:"text",class:"rounded-l block bg-white border-2 border-gray-100 p-2 flex-grow outline-none focus:border-blue-300"},null,544),[[h,a.text]]),n("button",{onClick:t[3]||(t[3]=(...e)=>c.sendMessage&&c.sendMessage(...e)),type:"submit",class:"rounded-r block bg-gray-100 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300"},"Send Message")])])};const re={name:"Game",props:{readonly:Boolean},components:{Canvas:V,Chat:te}},ae={class:"flex flex-col md:flex-row"};re.render=function(e,i,r,a,l,c){const d=t("Canvas"),h=t("Chat");return s(),o("div",ae,[n(d,{ref:"canvas",readonly:r.readonly,class:"md:w-1/2"},null,8,["readonly"]),n(h,{class:"md:mt-0 md:ml-4 md:w-1/2 mt-2"})])};const le={},ce={class:"h-screen bg-gray-100 bg-opacity-75 flex items-center justify-center absolute top-0 left-0 bottom-0 right-0"};le.render=function(e,t){return s(),o("div",ce,[g(e.$slots,"default")])};const de={name:"Room",components:{Game:re,Modal:le},props:{roomId:String},data:()=>({activeUserId:null,placeholder:"",showGame:!1,unsubscribe:null,word:"",words:[]}),computed:{inviteLink(){if(this.room){const{href:e}=this.$router.resolve({name:"doodle_invite",params:{inviteId:this.room.inviteId}});return e?`${location.protocol}//${location.host}${e}`:null}},isActive(){return this.activeUserId&&this.user.uid&&this.activeUserId===this.user.uid},name:{get(){return this.$store.state.name},set(e){this.$store.commit("setName",e)}},peers(){return this.$store.state.peers},readonly(){return!this.isActive},room(){return this.$store.state.rooms.find((e=>e.id===this.roomId))},user(){return this.$store.state.user}},methods:{chooseWord(e){this.word=e,this.words=[],this.sendWord()},copyInvite(){this.$refs.invite.select(),document.execCommand("copy")},makeActive(e){this.$store.dispatch("sendMessage",{type:"switch_user",data:{userId:e}})},pickWords(){return[...Array(3)].map((e=>this.pickWord()))},pickWord(){return this.$store.state.words[Math.floor(Math.random()*this.$store.state.words.length)]},sendWord(){const e=this.word.replace(/[a-zA-Z]/g,"_");this.$store.dispatch("sendMessage",{type:"placeholder",data:e})},startGame(){this.showGame=!0,this.$store.dispatch("sendMessage",{type:"start_game"}),this.words=this.pickWords()}},async created(){if(!this.room)return this.$router.push({name:"doodle"});this.activeUserId=this.room.ownerId,this.$store.dispatch("loadWords"),this.unsubscribe=this.$store.subscribe((({type:e,payload:t},s)=>{if("addMessage"===e)switch(t.type){case"start_game":this.showGame=!0;break;case"switch_user":this.activeUserId=t.data.userId;break;case"placeholder":this.placeholder=t.data}}))},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},he={class:"container mx-auto p-4"},ue={key:0},pe={key:0,class:"flex items-center justify-center font-bold mb-4 tracking-widest"},me={key:1},ge={class:"flex mb-2"},fe=n("div",{class:"rounded-l bg-gray-100 border-2 border-gray-100 p-2"},"Name",-1),be={class:"flex"},we={key:0,class:"flex justify-center mt-2"},ve={class:"flex flex-col w-full p-4"},ye={class:"p-2 mb-2"},xe={class:"text-sm text-gray-400"};de.render=function(e,r,a,m,g,f){const b=t("Game"),w=t("Modal");return s(),o("div",he,[g.showGame?(s(),o("div",ue,[g.word||g.placeholder?(s(),o("div",pe,l(g.word||g.placeholder),1)):c("",!0),n(b,{readonly:f.readonly,class:"mb-2"},null,8,["readonly"])])):(s(),o("div",me,[n("div",ge,[fe,d(n("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>f.name=e),type:"text",class:"rounded-r block bg-white border-2 border-gray-100 p-2 flex-grow outline-none focus:border-blue-300"},null,512),[[h,f.name]])]),n("div",be,[d(n("input",{ref:"invite","onUpdate:modelValue":r[2]||(r[2]=e=>f.inviteLink=e),type:"text",class:"rounded-l block bg-white border-2 border-gray-100 p-2 flex-grow outline-none focus:border-blue-300",readonly:""},null,512),[[h,f.inviteLink]]),n("button",{onClick:r[3]||(r[3]=(...e)=>f.copyInvite&&f.copyInvite(...e)),type:"submit",class:"rounded-r block bg-gray-100 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300"},"Copy Invite")]),f.isActive?(s(),o("div",we,[n("button",{onClick:r[4]||(r[4]=(...e)=>f.startGame&&f.startGame(...e)),type:"submit",class:"rounded block w-1/2 bg-gray-100 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300"}," Start Game ")])):c("",!0)])),g.words.length>0?(s(),o(w,{key:2},{default:i((()=>[n("div",ve,[(s(!0),o(u,null,p(g.words,(e=>(s(),o("button",{onClick:t=>f.chooseWord(e),class:"rounded block w-full bg-gray-200 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300 mb-2"},l(e),9,["onClick"])))),256))])])),_:1})):c("",!0),n("div",null,[(s(!0),o(u,null,p(f.peers,(e=>(s(),o("div",ye,[n("div",xe,l(e.name||e.id),1),e.id!==g.activeUserId?(s(),o("button",{key:0,onClick:t=>f.makeActive(e.id),type:"submit",class:"rounded block bg-gray-100 border-2 border-gray-100 p-2 outline-none focus:outline-none focus:border-blue-300 active:bg-blue-300"}," Make Active ",8,["onClick"])):c("",!0)])))),256))])])};const Me=f({history:b(),routes:[{path:"/",component:P},{name:"doodle",path:"/doodle",component:z},{name:"doodle_invite",path:"/doodle/invites/:inviteId",component:T,props:!0},{name:"doodle_room",path:"/doodle/rooms/:roomId",component:de,props:!0}]}),Se=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;class ke{constructor({id:e}){this.id=e,this.connection=new Se({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),this.onOpen=()=>{},this.onMessage=()=>{},this.channel=null}send(e){this.connection.iceConnectionState?this.channel?"open"===this.channel.readyState?this.channel.send(JSON.stringify(e)):console.info("dataChannel.readyState",this.channel.readyState):console.info("datachannel",this.channel):console.info("connection.iceConnectionState",this.connection.iceConnectionState)}createOffer(){return this.channel=this.connection.createDataChannel("main"),this.channel.onopen=this.onOpen,this.channel.onmessage=e=>{this.onMessage(JSON.parse(e.data))},new Promise(((e,t)=>{this.connection.createOffer().then((e=>{this.connection.setLocalDescription(e)})),this.connection.onicecandidate=t=>{null===t.candidate&&e(this.connection.localDescription)}}))}acceptOffer(e){const t=new RTCSessionDescription(e);return this.connection.ondatachannel=e=>{this.channel=e.channel,this.channel.onopen=this.onOpen,this.channel.onmessage=e=>{this.onMessage(JSON.parse(e.data))}},new Promise(((e,s)=>{this.connection.onicecandidate=t=>{null===t.candidate&&e(this.connection.localDescription)},this.connection.setRemoteDescription(t),this.connection.createAnswer().then((e=>{this.connection.setLocalDescription(e)})).catch(s)}))}acceptAnswer(e){return this.connection.setRemoteDescription(new RTCSessionDescription(e))}}const Le=()=>new Promise(((e,t)=>{a.auth().onAuthStateChanged((t=>{t&&e(t)}))})),Ce=w({state:()=>({messages:[],name:"",peers:[],rooms:[],user:null,words:[]}),mutations:{addMessage(e,t){e.messages.find((e=>e.id===t.id))||e.messages.push(t)},addPeer(e,t){e.peers.find((e=>e.id===t.id))||e.peers.push(t)},addRoom(e,t){e.rooms.find((e=>e.id===t.id))||e.rooms.push(t)},setName(e,t){e.name=t},setUser(e,t){e.user=t},setWords(e,t){e.words=t}},actions:{async connectToPeer(e,{id:t}){const s=await Le(),o=a.database().ref(`peers/${t}`).push(),n=new ke({id:t}),i=await n.createOffer();o.set({offer:{type:i.type,sdp:i.sdp},peerId:s.uid}),n.onMessage=t=>{e.commit("addMessage",t)},e.commit("addPeer",n)},connectToPeers:async(e,t)=>Promise.all(t.map((t=>e.dispatch("connectToPeer",t)))),async createRoom(t){const s=await Le(),o={members:[{id:s.uid}],ownerId:s.uid},n=await a.firestore().collection("rooms").add(o),i=e({id:v(6),inviteId:n.id},o);return t.commit("addRoom",i),t.dispatch("listenForPeers"),i},async joinRoom(e,t){const s=await Le(),o=a.firestore().collection("rooms").doc(t),n=await o.get(),i={id:s.uid},r=n.data(),l={id:v(6),inviteId:n.id,members:[...r.members,i],ownerId:r.ownerId};return o.set({members:a.firestore.FieldValue.arrayUnion(i)},{merge:!0}),e.commit("addRoom",l),e.dispatch("connectToPeers",r.members),e.dispatch("listenForPeers"),l},async listenForPeers(e){const t=await Le(),s=a.database().ref(`peers/${t.uid}`);s.remove(),s.on("child_added",(async s=>{if(s.val().offer){const o=new ke({id:s.val().peerId}),n=a.database().ref(`peers/${t.uid}/${s.key}`),i=a.database().ref(`peers/${s.val().peerId}`).push(),r=await o.acceptOffer(s.val().offer);n.remove(),i.set({answer:{type:r.type,sdp:r.sdp},peerId:t.uid}),o.onMessage=t=>{e.commit("addMessage",t)},e.commit("addPeer",o)}else if(s.val().answer){const o=e.state.peers.find((e=>e.id===s.val().peerId)),n=a.database().ref(`peers/${t.uid}/${s.key}`);o?o.acceptAnswer(s.val().answer):console.info("No peer found..."),n.remove()}}))},async loadWords(e){const t=await fetch("/words.json"),s=await t.json();e.commit("setWords",s)},async sendMessage(e,{type:t,data:s}){const o=await Le(),n={id:v(),peer:{id:o.uid,name:e.state.name},data:s,type:t};return e.commit("addMessage",n),Promise.all(e.state.peers.map((e=>new Promise(((t,s)=>{e.send(n),t()})))))}}});a.auth().signInAnonymously(),a.auth().onAuthStateChanged((e=>{e&&Ce.commit("setUser",e)}));const ze=y(x);ze.use(Me),ze.use(Ce),ze.mount("#app");
